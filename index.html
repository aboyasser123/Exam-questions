<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>فحص اتمتة - اختبار سريع</title>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
 /* ===== VARIABLES & RESET ===== */
:root {
    --primary: #2d5af1;
    --primary-dark: #1a49e0;
    --secondary: #ff6b6b;
    --accent: #00d4aa;
    --dark: #1a1a2e;
    --darker: #0f0f1a;
    --light: #f8f9fa;
    --gray: #6c757d;
    --success: #28a745;
    --danger: #dc3545;
    --warning: #ffc107;
    --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    --shadow-sm: 0 5px 15px rgba(0, 0, 0, 0.2);
    --radius: 20px;
    --radius-sm: 12px;
    --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', 'Cairo', sans-serif;
}

body {
    background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
    color: var(--light);
    min-height: 100vh;
    padding: 20px;
    direction: rtl;
}

/* ===== GENERAL SCREEN STYLES ===== */
.screen {
    display: none;
    max-width: 1200px;
    margin: 0 auto;
    padding: 30px;
    animation: fadeIn 0.8s ease-out;
}

.screen.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

/* ===== TYPOGRAPHY ===== */
h1 {
    text-align: center;
    font-size: 3.2rem;
    margin-bottom: 2.5rem;
    background: linear-gradient(90deg, var(--accent), var(--primary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    text-shadow: 0 5px 15px rgba(45, 90, 241, 0.2);
    padding-bottom: 15px;
    position: relative;
}

h1::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: 50%;
    transform: translateX(50%);
    width: 150px;
    height: 4px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    border-radius: 2px;
}

h2 {
    font-size: 1.8rem;
    line-height: 1.6;
    margin-bottom: 2rem;
    color: var(--light);
    text-align: center;
}

/* ===== BUTTONS ===== */
.btn {
    padding: 18px 35px;
    border: none;
    border-radius: var(--radius-sm);
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    min-width: 200px;
    margin: 10px auto;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
    z-index: 1;
}

.btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.7s;
    z-index: -1;
}

.btn:hover::before {
    left: 100%;
}

.btn:active {
    transform: translateY(3px);
}

.btn-start {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    font-size: 1.4rem;
    padding: 22px 50px;
    box-shadow: var(--shadow);
    border: 2px solid rgba(255, 255, 255, 0.1);
}

.btn-start:hover {
    background: linear-gradient(135deg, var(--primary-dark) 0%, #0d3ccf 100%);
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(45, 90, 241, 0.4);
}

.btn-nav {
    background: rgba(255, 255, 255, 0.1);
    color: var(--light);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.btn-nav:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-3px);
}

.btn-submit {
    background: linear-gradient(135deg, var(--accent) 0%, #00b894 100%);
    color: var(--darker);
    font-weight: 800;
    box-shadow: var(--shadow-sm);
}

.btn-submit:hover {
    background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
    transform: translateY(-3px);
}

.btn-restart {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
}

.btn-home {
    background: rgba(255, 255, 255, 0.1);
    color: var(--light);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

/* ===== START SCREEN ===== */
#start-screen {
    text-align: center;
    padding-top: 80px;
}

#start-screen h1 {
    font-size: 4rem;
    margin-bottom: 3rem;
    animation: pulse 2s infinite;
}

#start-screen .fa-brain {
    font-size: 4.5rem;
    margin-left: 20px;
    background: linear-gradient(135deg, var(--accent), var(--primary));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

/* ===== SUBJECT & LECTURE SCREENS ===== */
#subject-list, #lecture-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 25px;
    max-width: 1000px;
    margin: 40px auto;
}

.btn-subject, .btn-lecture {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    color: var(--light);
    padding: 25px 20px;
    font-size: 1.3rem;
    border-radius: var(--radius);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    height: 100%;
    min-height: 140px;
    position: relative;
    overflow: hidden;
}

.btn-subject::after, .btn-lecture::after {
    content: '';
    position: absolute;
    bottom: 0;
    right: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    transform: scaleX(0);
    transition: transform 0.4s ease;
}

.btn-subject:hover, .btn-lecture:hover {
    background: rgba(255, 255, 255, 0.1);
    transform: translateY(-8px);
    border-color: rgba(255, 255, 255, 0.2);
    box-shadow: var(--shadow);
}

.btn-subject:hover::after, .btn-lecture:hover::after {
    transform: scaleX(1);
}

.btn-lecture:first-child {
    background: linear-gradient(135deg, rgba(45, 90, 241, 0.2), rgba(0, 212, 170, 0.2));
    border: 2px solid var(--primary);
    font-weight: bold;
    grid-column: 1 / -1;
}

.btn-lecture:first-child:hover {
    background: linear-gradient(135deg, rgba(45, 90, 241, 0.3), rgba(0, 212, 170, 0.3));
}

/* ===== EXAM SCREEN ===== */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255, 255, 255, 0.05);
    padding: 20px 30px;
    border-radius: var(--radius);
    margin-bottom: 40px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    flex-wrap: wrap;
    gap: 20px;
}

.timer-box, .progress-box, .score-box {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 1.3rem;
    padding: 15px 25px;
    border-radius: var(--radius-sm);
    background: rgba(0, 0, 0, 0.3);
    min-width: 200px;
    justify-content: center;
}

.timer-box { color: var(--accent); }
.progress-box { color: var(--primary); }
.score-box { color: var(--warning); }

.fa-clock, .fa-list-ol, .fa-star {
    font-size: 1.8rem;
}

#timer {
    font-family: 'Courier New', monospace;
    font-weight: bold;
    font-size: 1.8rem;
}

.timer-warning { color: var(--warning) !important; animation: pulse 1s infinite; }
.timer-danger { color: var(--danger) !important; animation: pulse 0.5s infinite; }

.question-container {
    background: rgba(255, 255, 255, 0.05);
    border-radius: var(--radius);
    padding: 40px;
    margin-bottom: 40px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    min-height: 350px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-top: 30px;
}

.option-btn {
    padding: 22px 25px;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.15);
    color: var(--light);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: var(--transition);
    font-size: 1.2rem;
    text-align: right;
    position: relative;
    overflow: hidden;
}

.option-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-5px);
    border-color: var(--primary);
}

.option-btn.selected {
    background: linear-gradient(135deg, rgba(45, 90, 241, 0.3), rgba(0, 212, 170, 0.3));
    border-color: var(--primary);
    color: white;
    box-shadow: 0 8px 25px rgba(45, 90, 241, 0.3);
}

.navigation {
    display: flex;
    justify-content: space-between;
    padding: 20px 0;
    gap: 20px;
    flex-wrap: wrap;
}

/* ===== RESULTS SCREEN ===== */
.result-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 25px;
    margin: 40px 0;
}

.result-stats p {
    background: rgba(255, 255, 255, 0.05);
    padding: 25px;
    border-radius: var(--radius);
    font-size: 1.3rem;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.1);
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.result-stats span {
    font-size: 2.2rem;
    font-weight: bold;
    display: block;
}

.result-stats p:nth-child(1) span { color: var(--success); }
.result-stats p:nth-child(2) span { color: var(--danger); }
.result-stats p:nth-child(3) span { color: var(--warning); }
.result-stats p:nth-child(4) span { color: var(--accent); }

#answers-review {
    max-height: 500px;
    overflow-y: auto;
    margin: 40px 0;
    padding: 20px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: var(--radius);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.answer-item {
    background: rgba(255, 255, 255, 0.05);
    padding: 25px;
    margin-bottom: 20px;
    border-radius: var(--radius-sm);
    border-right: 5px solid var(--gray);
    transition: var(--transition);
}

.answer-item:hover {
    transform: translateX(-10px);
}

.answer-item.correct {
    border-right-color: var(--success);
    background: rgba(40, 167, 69, 0.1);
}

.answer-item.wrong {
    border-right-color: var(--danger);
    background: rgba(220, 53, 69, 0.1);
}

.answer-item.skipped {
    border-right-color: var(--warning);
    background: rgba(255, 193, 7, 0.1);
}

.answer-item strong {
    color: var(--accent);
    font-size: 1.2rem;
    display: block;
    margin-bottom: 10px;
}

.answer-item br {
    margin-bottom: 8px;
    display: block;
    content: "";
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 992px) {
    h1 { font-size: 2.8rem; }
    .btn { padding: 16px 30px; font-size: 1.1rem; min-width: 180px; }
    #subject-list, #lecture-list { grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); }
    .header { flex-direction: column; text-align: center; }
    .timer-box, .progress-box, .score-box { min-width: 100%; }
    .options { grid-template-columns: 1fr; }
}

@media (max-width: 768px) {
    body { padding: 10px; }
    .screen { padding: 20px 15px; }
    h1 { font-size: 2.4rem; margin-bottom: 2rem; }
    h2 { font-size: 1.5rem; }
    .question-container { padding: 25px; min-height: 300px; }
    .result-stats { grid-template-columns: 1fr; }
    .navigation { flex-direction: column; align-items: center; }
    .btn { width: 100%; max-width: 400px; }
    .btn-subject, .btn-lecture { min-height: 120px; font-size: 1.2rem; }
    #start-screen h1 { font-size: 3rem; }
}

@media (max-width: 480px) {
    h1 { font-size: 2rem; }
    .timer-box, .progress-box, .score-box { font-size: 1.1rem; padding: 12px; }
    #timer { font-size: 1.5rem; }
    .fa-clock, .fa-list-ol, .fa-star { font-size: 1.5rem; }
    .option-btn { padding: 18px 20px; font-size: 1.1rem; }
    .answer-item { padding: 18px; }
    .result-stats p { padding: 20px; font-size: 1.1rem; }
    .result-stats span { font-size: 1.8rem; }
}

/* ===== SCROLLBAR ===== */
::-webkit-scrollbar {
    width: 12px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(var(--primary), var(--accent));
    border-radius: 10px;
    border: 3px solid var(--dark);
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(var(--primary-dark), #00c29a);
}

/* ===== ANIMATIONS & EFFECTS ===== */
.fa-brain {
    animation: float 3s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-15px); }
}

/* تأثير النقاط في الخلفية */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        radial-gradient(circle at 20% 30%, rgba(45, 90, 241, 0.15) 2px, transparent 2px),
        radial-gradient(circle at 80% 70%, rgba(0, 212, 170, 0.15) 2px, transparent 2px),
        radial-gradient(circle at 40% 80%, rgba(255, 107, 107, 0.1) 1px, transparent 1px);
    background-size: 80px 80px, 100px 100px, 150px 150px;
    z-index: -1;
    pointer-events: none;
}

/* تأثيرات الإجابات الصحيحة/الخاطئة */
.option-btn.correct-feedback {
    animation: correctFlash 0.5s ease;
}

.option-btn.wrong-feedback {
    animation: wrongFlash 0.5s ease;
}

@keyframes correctFlash {
    0%, 100% { background: linear-gradient(135deg, rgba(45, 90, 241, 0.3), rgba(0, 212, 170, 0.3)); }
    50% { background: linear-gradient(135deg, var(--success), #20c997); }
}

@keyframes wrongFlash {
    0%, 100% { background: linear-gradient(135deg, rgba(45, 90, 241, 0.3), rgba(0, 212, 170, 0.3)); }
    50% { background: linear-gradient(135deg, var(--danger), #e35d6a); }
}

/* تأثيرات للنتائج */
#final-score {
    display: inline-block;
    animation: scorePulse 2s infinite;
}

@keyframes scorePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.option-btn.correct-answer {
    background-color: #4caf50; /* أخضر */
    color: white;
}

.option-btn.wrong-answer {
    background-color: #f44336; /* أحمر */
    color: white;
}

.option-btn.selected {
    border: 2px solid #2196f3; /* تمييز الاختيار */
}

    </style>
</head>
<body>

    <!-- شاشة البداية -->
    <div id="start-screen" class="screen active">
        <h1><i class="fas fa-brain"></i> فحص اتمتة</h1>
        <button id="start-btn" class="btn btn-start"><i class="fas fa-play"></i> بدء الاختبار</button>
    </div>

    <!-- اختيار المادة -->
    <div id="subject-screen" class="screen">
        <h1>اختر المادة</h1>
        <div id="subject-list"></div>
    </div>

    <!-- اختيار المحاضرة -->
    <div id="lecture-screen" class="screen">
        <h1 id="lecture-title"></h1>
        <div id="lecture-list"></div>
        <button id="back-subjects" class="btn btn-nav">رجوع للمواد</button>
    </div>

    <!-- شاشة الاختبار -->
    <div id="exam-screen" class="screen">
        <div class="header">
            <div class="timer-box"><i class="fas fa-clock"></i> <span id="timer">20:00</span></div>
            <div class="progress-box"><i class="fas fa-list-ol"></i> سؤال <span id="current-q">1</span> من 20</div>
            <div class="score-box"><i class="fas fa-star"></i> النقاط: <span id="score">0</span></div>
        </div>

        <div class="question-container">
            <h2 id="question-text">السؤال يظهر هنا...</h2>
            <div id="options-container" class="options"></div>
        </div>

        <div class="navigation">
            <button id="prev-btn" class="btn btn-nav">السابق</button>
            <button id="next-btn" class="btn btn-nav">التالي</button>
            <button id="submit-btn" class="btn btn-submit">إنهاء الاختبار</button>
        </div>
    </div>

    <!-- شاشة النتائج -->
    <div id="result-screen" class="screen">
        <h1><i class="fas fa-chart-line"></i> نتائج الاختبار</h1>
        <div class="result-stats">
            <p>الإجابات الصحيحة: <span id="correct-count">0</span></p>
            <p>الإجابات الخاطئة: <span id="wrong-count">0</span></p>
            <p>الأسئلة غير المجابة: <span id="skipped-count">0</span></p>
            <p>المعدل النهائي: <span id="final-score">0%</span></p>
        </div>
        <div id="answers-review"></div>
        <button id="restart-btn" class="btn btn-restart">إعادة الاختبار</button>
        <button id="home-btn" class="btn btn-home">العودة للرئيسية</button>
    </div>

    <!-- الأصوات -->
    <audio id="correct-sound" src="correct.mp3"></audio>
    <audio id="wrong-sound" src="wrong.mp3"></audio>

<script>
    // ===================== البيانات =====================
    const subjects = {
        algo2: {
            name: "خوارزميات 2",
            lectures: {
                lec1: [
                 ],
                lec2: [
                 ],
                lec3: [
{ question: "في خوارزمية هوفمان، أين توضع الأحرف؟", 
   options: ["في العقد غير الورقية", "في الجذر فقط", "في الأوراق", "في الفروع"], 
   correct: 2,
   explanation: "الأحرف توضع في الأوراق فقط." },

 { question: "ما الهدف الأساسي من خوارزمية هوفمان؟", 
   options: ["ترتيب الأحرف", "ضغط البيانات بأقصر تمثيل ثنائي", "تشفير النص بكلمة سر", "بناء شجرة بحث"], 
   correct: 1,
   explanation: "الهدف هو ضغط البيانات بحيث يكون لكل حرف تمثيل ثنائي أقصر حسب تكراره." },

 { question: "في شجرة هوفمان، الحرف الأكثر تكراراً يكون:", 
   options: ["أبعد عن الجذر", "في المنتصف", "أقرب إلى الجذر", "ليس له علاقة"], 
   correct: 2,
   explanation: "الحروف الأكثر تكراراً توضع أقرب للجذر لتقصير طول الشيفرة." },

 { question: "عدد عقد شجرة هوفمان إذا كان عدد الأحرف n يساوي:", 
   options: ["n", "2n", "2n - 1", "n - 1"], 
   correct: 2,
   explanation: "شجرة هوفمان تحتوي على 2n-1 عقد إذا كان عدد الأحرف n." },

 { question: "لماذا لا يجوز أن تكون شيفرة حرف بداية لشيفرة حرف آخر؟", 
   options: ["لتقليل الذاكرة", "لمنع الغموض عند فك التشفير", "لتسريع البحث", "لأنه شرط شكلي"], 
   correct: 1,
   explanation: "لكي لا يكون هناك غموض عند فك الشيفرة." },


 // ============================
 // المرحلة 2: التكرار والاختيار
 // ============================

 { question: "في كل خطوة من بناء شجرة هوفمان نختار:", 
   options: ["أكبر تكرارين", "أصغر تكرارين غير مستخدمين", "أي عقدتين", "العقد الورقية فقط"], 
   correct: 1,
   explanation: "نختار أصغر عقدتين غير مستخدمتين لدمجهما." },

 { question: "إذا كانت التكرارات: a=5 , b=2 , c=1 , d=1 فما أول عقدتين يتم دمجهما؟", 
   options: ["a و b", "c و d", "a و c", "b و c"], 
   correct: 1,
   explanation: "أصغر تكرارين هما c و d، لذا ندمجهما أولاً." },

 { question: "تكرار العقدة الأب يساوي:", 
   options: ["أكبر تكرار بين الأبناء", "أصغر تكرار", "مجموع تكراري الابنين", "عدد العقد"], 
   correct: 2,
   explanation: "تكرار العقدة الأب يساوي مجموع تكراري الابنين." },

 { question: "العقد التي لها del = true هي:", 
   options: ["العقد المحذوفة", "العقد المستخدمة", "العقد المتاحة للاختيار", "العقد الجذر"], 
   correct: 2,
   explanation: "del = true تعني أن العقدة تم اختيارها أو مستخدمة." },

 { question: "بعد اختيار عقدة بواسطة findminfreq فإن del تصبح:", 
   options: ["true", "false", "null", "1"], 
   correct: 1,
   explanation: "بعد الاختيار تصبح del = false لتمييز أنها مستخدمة." },


 // ============================
 // المرحلة 3: التمثيل بالمصفوفة
 // ============================

 { question: "تمثيل شجرة هوفمان في البرنامج يتم باستخدام:", 
   options: ["مصفوفة عقد", "مصفوفة محارف", "Stack", "Queue"], 
   correct: 0,
   explanation: "يتم تمثيل الشجرة باستخدام مصفوفة العقد." },

 { question: "الحقل father في العقدة يشير إلى:", 
   options: ["عدد الأبناء", "تكرار الأب", "دليل العقدة الأب", "يمين أو يسار"], 
   correct: 2,
   explanation: "father يخزن فهرس العقدة الأب لكل عقدة." },

 { question: "الحقل isLeft يدل على:", 
   options: ["هل العقدة ورقة", "هل العقدة يسارية", "هل العقدة مستخدمة", "هل هي جذر"], 
   correct: 1,
   explanation: "isLeft يحدد إذا كانت العقدة الابنة يسارية أم لا." },

 { question: "الجذر في شجرة هوفمان يكون عند الفهرس:", 
   options: ["0", "n", "2n-2", "2n-1"], 
   correct: 2,
   explanation: "الجذر يكون عند الفهرس 2n-2 في تمثيل المصفوفة." },

 { question: "عدد العقد الورقية في شجرة هوفمان يساوي:", 
   options: ["n", "2n-1", "n-1", "2n"], 
   correct: 0,
   explanation: "عدد العقد الورقية يساوي عدد الأحرف n." },


 // ============================
 // المرحلة 4: الترميز (Code)
 // ============================

 { question: "عند الصعود من ابن يساري إلى الأب نضيف:", 
   options: ["1", "0", "لا شيء", "حسب التكرار"], 
   correct: 1,
   explanation: "نضيف 0 عند الصعود من ابن يساري." },

 { question: "عند الصعود من ابن يميني إلى الأب نضيف:", 
   options: ["0", "1", "حسب العمق", "لا شيء"], 
   correct: 1,
   explanation: "نضيف 1 عند الصعود من ابن يميني." },

 { question: "يتم توليد شيفرة الحرف بالتحرك من:", 
   options: ["الجذر إلى الورقة", "الورقة إلى الجذر", "اليمين إلى اليسار", "اليسار إلى اليمين"], 
   correct: 1,
   explanation: "نبدأ من الورقة إلى الجذر لتوليد الشيفرة." },

 { question: "تخزن الشيفرة في:", 
   options: ["node", "symbol", "CodeType", "alph"], 
   correct: 2,
   explanation: "الشيفرة تخزن في هيكل CodeType." },

 { question: "startPos في CodeType يدل على:", 
   options: ["عدد البتات", "بداية الشيفرة داخل المصفوفة", "نهاية الشيفرة", "طول الرسالة"], 
   correct: 1,
   explanation: "startPos يحدد بداية الشيفرة في مصفوفة البتات." },


 // ============================
 // المرحلة 5: خصائص الشيفرة
 // ============================

 { question: "شيفرة هوفمان هي:", 
   options: ["ثابتة الطول", "متغيرة الطول", "عشوائية", "ثلاثية"], 
   correct: 1,
   explanation: "شيفرة هوفمان متغيرة الطول حسب تكرار الحروف." },

 { question: "الأحرف الأقل تكراراً يكون لها:", 
   options: ["أقصر شيفرة", "أطول شيفرة", "نفس الطول", "بدون شيفرة"], 
   correct: 1,
   explanation: "الأحرف الأقل تكراراً لها أطول شيفرة." },

 { question: "إذا تغيرت التكرارات فإن:", 
   options: ["الشيفرة تبقى نفسها", "الشجرة تتغير", "الجذر فقط يتغير", "لا شيء يتغير"], 
   correct: 1,
   explanation: "تغيير التكرارات يغير الشجرة وبالتالي الشيفرة." },

 { question: "سبب أن شيفرة هوفمان تضغط البيانات هو:", 
   options: ["تستخدم 0 و 1 فقط", "تعطي الأقصر للأكثر تكراراً", "تلغي بعض الأحرف", "تعيد ترتيب النص"], 
   correct: 1,
   explanation: "الشيفرة تعطي رموز أقصر للحروف الأكثر تكراراً." },

 { question: "هل يمكن أن يكون حرفان لهما نفس الشيفرة؟", 
   options: ["نعم", "لا", "أحياناً", "حسب التكرار"], 
   correct: 1,
   explanation: "لا، كل حرف له شيفرة فريدة لتجنب الغموض." }
                ],
                lec4:[
 
                ]
            }
        },
        circuits: {
            name: "نظرية المخططات",
            lectures: {
                lec1: [
                 ]
            }
        }
    };

    let currentQuestion = 0;
    let userAnswers = [];
    let score = 0;
    let timer;
    let timeLeft = 20 * 60;
    let questions = [];

    // عناصر DOM
    const startScreen = document.getElementById('start-screen');
    const subjectScreen = document.getElementById('subject-screen');
    const lectureScreen = document.getElementById('lecture-screen');
    const examScreen = document.getElementById('exam-screen');
    const resultScreen = document.getElementById('result-screen');
    const startBtn = document.getElementById('start-btn');
    const timerDisplay = document.getElementById('timer');
    const currentQDisplay = document.getElementById('current-q');
    const scoreDisplay = document.getElementById('score');
    const questionText = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const submitBtn = document.getElementById('submit-btn');
    const correctSound = document.getElementById('correct-sound');
    const wrongSound = document.getElementById('wrong-sound');
    const correctCountDisplay = document.getElementById('correct-count');
    const wrongCountDisplay = document.getElementById('wrong-count');
    const skippedCountDisplay = document.getElementById('skipped-count');
    const finalScoreDisplay = document.getElementById('final-score');
    const answersReview = document.getElementById('answers-review');
    const restartBtn = document.getElementById('restart-btn');
    const homeBtn = document.getElementById('home-btn');
    const subjectList = document.getElementById('subject-list');
    const lectureList = document.getElementById('lecture-list');
    const lectureTitle = document.getElementById('lecture-title');
    const backSubjectsBtn = document.getElementById('back-subjects');

    // ===================== وظائف اختيار المادة والمحاضرة =====================
    function showSubjects() {
        subjectList.innerHTML = '';
        Object.keys(subjects).forEach(subKey => {
            const sub = subjects[subKey];
            const btn = document.createElement('button');
            btn.textContent = sub.name;
            btn.className = 'btn-subject';
            btn.addEventListener('click', () => showLectures(subKey));
            subjectList.appendChild(btn);
        });
        startScreen.classList.remove('active');
        subjectScreen.classList.add('active');
    }

   function showLectures(subKey) {
    const sub = subjects[subKey];
    lectureTitle.textContent = sub.name;
    lectureList.innerHTML = '';

    // زر الفحص الشامل لجميع المحاضرات
    const fullExamBtn = document.createElement('button');
    fullExamBtn.textContent = `فحص شامل لجميع المحاضرات`;
    fullExamBtn.className = 'btn-lecture';
    fullExamBtn.addEventListener('click', () => startFullExam(subKey));
    lectureList.appendChild(fullExamBtn);

    // عرض المحاضرات العادية
    Object.keys(sub.lectures).forEach(lecKey => {
        const btn = document.createElement('button');
        btn.textContent = `المحاضرة ${lecKey.replace('lec','')}`;
        btn.className = 'btn-lecture';
        btn.addEventListener('click', () => startLecture(subKey, lecKey));
        lectureList.appendChild(btn);
    });

    subjectScreen.classList.remove('active');
    lectureScreen.classList.add('active');
}

// وظيفة فحص شامل لجميع المحاضرات
function startFullExam(subKey) {
    const allLectures = subjects[subKey].lectures;
    let allQuestions = [];
    Object.values(allLectures).forEach(lec => {
        allQuestions = allQuestions.concat(lec);
    });

    questions = shuffleArray(allQuestions).slice(0, 20); // نأخذ 20 سؤال عشوائي
    userAnswers = new Array(questions.length).fill(-1);
    currentQuestion = 0;
    score = 0;
    timeLeft = 20 * 60;
    scoreDisplay.textContent = '0';
    timerDisplay.textContent = '20:00';
    timerDisplay.classList.remove('timer-warning', 'timer-danger');

    lectureScreen.classList.remove('active');
    examScreen.classList.add('active');
    startTimer();
    displayQuestion(0);
}


    backSubjectsBtn.addEventListener('click', () => {
        lectureScreen.classList.remove('active');
        subjectScreen.classList.add('active');
    });

    function startLecture(subKey, lecKey) {
        const allQuestions = subjects[subKey].lectures[lecKey];
        questions = shuffleArray(allQuestions).slice(0, 20);
        userAnswers = new Array(questions.length).fill(-1);
        currentQuestion = 0;
        score = 0;
        timeLeft = 20 * 60;
        scoreDisplay.textContent = '0';
        timerDisplay.textContent = '20:00';
        timerDisplay.classList.remove('timer-warning', 'timer-danger');

        lectureScreen.classList.remove('active');
        examScreen.classList.add('active');
        startTimer();
        displayQuestion(0);
    }

    function shuffleArray(array) {
        let arr = array.slice();
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    // ===================== وظائف الاختبار =====================
    function startTimer() {
        clearInterval(timer);
        timer = setInterval(() => {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
            if(timeLeft <= 60) timerDisplay.classList.add('timer-danger');
            else if(timeLeft <= 300) timerDisplay.classList.add('timer-warning');
            if(timeLeft <= 0){ clearInterval(timer); finishExam(); }
        },1000);
    }

    function displayQuestion(index){
        currentQuestion = index;
        const q = questions[index];
        currentQDisplay.textContent = index + 1;
        questionText.textContent = q.question;
        optionsContainer.innerHTML = '';
        q.options.forEach((opt,i)=>{
            const btn = document.createElement('button');
            btn.textContent = opt;
            btn.className = 'option-btn';
            if(userAnswers[index]===i) btn.classList.add('selected');
            btn.addEventListener('click', ()=> selectOption(i));
            optionsContainer.appendChild(btn);
        });
        prevBtn.disabled = index===0;
        nextBtn.disabled = index===questions.length-1;
    }

function selectOption(optionIndex) {
    // إذا الجواب موجود بالفعل ما في تعديل
    if (userAnswers[currentQuestion] !== -1) return;

    // حفظ الإجابة
    userAnswers[currentQuestion] = optionIndex;

    const options = document.querySelectorAll('.option-btn');

    const isCorrect = optionIndex === questions[currentQuestion].correct;

    options.forEach((btn, i) => {
        btn.classList.remove('selected');

        if (i === optionIndex) {
            btn.classList.add('selected');
        }

        // تلوين الإجابة الصحيحة والخاطئة
        if (i === questions[currentQuestion].correct) {
            btn.classList.add('correct-answer'); // أخضر
        } else if (i === optionIndex && !isCorrect) {
            btn.classList.add('wrong-answer'); // أحمر
        }

        // تعطيل الخيارات فقط، مش زر التالي
        btn.disabled = true;
    });

    // الأصوات
    if (isCorrect) {
        playSound('correct');
        score++;
        scoreDisplay.textContent = score;

        // انتقال تلقائي بعد نص ثانية
        setTimeout(() => {
            if (currentQuestion < questions.length - 1) {
                displayQuestion(currentQuestion + 1);
            } else {
                finishExam();
            }
        }, 500);
    } else {
        // إذا غلط، صوت خطأ، واللاعب يضغط "التالي" بنفسه
        playSound('wrong');
        nextBtn.disabled = false; // تأكد أن زر التالي مفعل
    }
}



    prevBtn.addEventListener('click', ()=> {
        if(currentQuestion>0) displayQuestion(currentQuestion-1);
    });

    nextBtn.addEventListener('click', ()=> {
        if(currentQuestion<questions.length-1) displayQuestion(currentQuestion+1);
    });

    submitBtn.addEventListener('click', ()=> {
        if(confirm("هل أنت متأكد من إنهاء الاختبار؟")) finishExam();
    });

    function finishExam(){
        clearInterval(timer);
        let correct=0,wrong=0,skipped=0;
        questions.forEach((q,i)=>{
            if(userAnswers[i]===-1) skipped++;
            else if(userAnswers[i]===q.correct) correct++;
            else wrong++;
        });
        const finalScore = Math.round((correct/questions.length)*100);
        correctCountDisplay.textContent = correct;
        wrongCountDisplay.textContent = wrong;
        skippedCountDisplay.textContent = skipped;
        finalScoreDisplay.textContent = finalScore+'%';
        answersReview.innerHTML = '';
        questions.forEach((q,i)=>{
            const div = document.createElement('div');
            div.className='answer-item';
            let status='skipped', statusText='غير مجاب', userAnswerText='لم تجب';
            if(userAnswers[i]!==-1){
                userAnswerText=q.options[userAnswers[i]];
                if(userAnswers[i]===q.correct){ status='correct'; statusText='صحيح'; }
                else { status='wrong'; statusText='خطأ'; }
            }
            div.classList.add(status);
            div.innerHTML = `<strong>سؤال ${i+1}:</strong> ${q.question}<br>
            إجابتك: ${userAnswerText}<br>
            الإجابة الصحيحة: ${q.options[q.correct]}<br>
            الحالة: ${statusText}<br>
            شرح: ${q.explanation}`;
            answersReview.appendChild(div);
        });

        examScreen.classList.remove('active');
        resultScreen.classList.add('active');

        if(finalScore>=70) playSound('correct'); else playSound('wrong');
    }

    restartBtn.addEventListener('click', ()=>{
        currentQuestion=0; userAnswers=[]; score=0; timeLeft=20*60;
        scoreDisplay.textContent='0'; timerDisplay.textContent='20:00';
        timerDisplay.classList.remove('timer-warning','timer-danger');
        resultScreen.classList.remove('active'); startScreen.classList.add('active');
    });

    homeBtn.addEventListener('click', ()=>{
        resultScreen.classList.remove('active'); startScreen.classList.add('active');
    });

    function playSound(type){
        if(type==='correct'){ correctSound.currentTime=0; correctSound.play(); }
        else if(type==='wrong'){ wrongSound.currentTime=0; wrongSound.play(); }
    }

    startBtn.addEventListener('click', showSubjects);
</script>
</body>
</html>
